
<div class="card rounded shadow-sm p-3 m-5">
  <div class="d-flex mb-1">
    <div class="flex-fill pr-3">

      <div class="input-group mb-2">
          <div class="input-group-prepend">
              <div class="input-group-text">Filtro: </div>
          </div>
          <input type="text" placeholder="Buscar por registros" class="form-control" (input)="onChange($event)"/>
      </div>
     </div>
      <div>
          <a class="d-flex btn btn-outline-primary" routerLink="/dashboard/patrimonio">
              <i class="fa fa-plus-circle my-1"></i>
              <b class="ml-1 d-none d-sm-block"> Novo</b>
          </a>
      </div>
      <div class="ml-1" *ngIf="ehAdministrador" >
        <button class="btn btn-success mb-1" (click)="exportarParaExcel()"> <i class="fa fa-file-excel-o my-1" id="icone-excel"></i> Exportar para Excel</button>
      </div>
  </div>
  <ngx-table
  [data]="data"
  [configuration]="configuracao"
  [columns]="colunas"
  [noResultsTemplate]="mensagemSemCadastro"
  [summaryTemplate]="summaryTemplateRef"
  [detailsTemplate]="detailsTemplate"

  #table>
  <ng-template let-row let-index="index">
    <td>
      <div class="font-small">{{ row.codigoPatrimonio }}</div>
    </td>
    <td *ngIf="!isMobile">
      <span class="font-small">{{ row.situacaoEquipamento | enumDisplay:row.situacaoEquipamento}}</span>
    </td>
    <td>
      <span class="font-small">{{ row.tipoEquipamento }}</span>
    </td>
    <td>
      <span class="font-small">{{ row.nomeFuncionario }}</span>
    </td>
    <td *ngIf="isMobile">
      <button
        class="btn btn-primary"
        id="expandButton-{{ index }}"
        (click)="onRowClickEvent($event, index)"
      >
        <i class="icon icon-arrow-left" *ngIf="!toggledRows.has(index)"></i>
        <i class="icon icon-arrow-down" *ngIf="toggledRows.has(index)"></i>
        Expandir
      </button>
    </td>
    <td *ngIf="!isMobile">
      <button class="btn btn-warning btn-lg" role="button" (click)="detalhePatrimonio(row.codigoPatrimonio)">
        Alterar
      </button>
      </td>
    <td *ngIf="!isMobile">
        <button class="btn btn-danger btn-lg" role="button" (click)="abrirModal($event, template, row.codigoPatrimonio)">
          Excluir
        </button>
    </td>

    </ng-template>
  </ngx-table>
</div>
<ng-template #template>
  <div class="modal-body text-center">
    <p>Deseja confirmar a exclusão do patrimônio de código {{patrimonioId}}?</p>
    <button type="button" class="btn btn-default" (click)="confirmar()">Sim</button>
    <button type="button" class="btn btn-primary" (click)="recusar()">Não</button>
  </div>
</ng-template>
<ng-template #mensagemSemCadastro>
  <td [attr.colspan]="colunas.length" class="no-results text-center">
    <h4>Não há nenhum patrimônio cadastrado</h4>
  </td>
</ng-template>

<ng-template #summaryTemplateRef let-total="total">
  <th>Total de registros: {{ total }}</th>
</ng-template>

<ng-template #detailsTemplate let-row>
  <p>Situação do equipamento: {{row.situacaoEquipamento}}</p>
    <button
      class="btn btn-warning btn-lg"
      (click)="detalhePatrimonio(row.codigoPatrimonio)"
    >
      Alterar
  </button>
  <button
  class="btn btn-danger btn-lg"
  (click)="abrirModal($event, template, row.codigoPatrimonio)"
>
  Excluir
</button>
</ng-template>
<ngx-spinner name="buscando" bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "ball-clip-rotate" [fullScreen] = "true"><p style="color: white" > Buscando... </p></ngx-spinner>
<ngx-spinner name="excluindo" bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "ball-clip-rotate" [fullScreen] = "true"><p style="color: white" > Excluindo... </p></ngx-spinner>
